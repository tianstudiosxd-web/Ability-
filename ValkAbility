local player = game.Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

-- Movement Variables
local currentSpeed = 16
local currentJumpHeight = 7.2
local infiniteJumpEnabled = false
local isMinimized = false
local currentCategory = "Movement"
local guiActive = true
local heartbeatConnection = nil

-- Original Fly Variables
local speeds = 1
local nowe = false
local flyUpConnection, flyDownConnection

-- Fling Aura Variables
local flingAuraEnabled = false
local flingDistance = 5
local flingConnection = nil

-- GUI Creation
local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local TopBar = Instance.new("Frame")
local TitleLabel = Instance.new("TextLabel")
local MinimizeButton = Instance.new("TextButton")
local ExitButton = Instance.new("TextButton")
local ContentFrame = Instance.new("Frame")
local LeftFrame = Instance.new("ScrollingFrame")
local MovementButton = Instance.new("TextButton")
local AbilityButton = Instance.new("TextButton")
local RightFrame = Instance.new("ScrollingFrame")
local WalkspeedLabel = Instance.new("TextLabel")
local SpeedDisplay = Instance.new("TextLabel")
local MinusButton = Instance.new("TextButton")
local PlusButton = Instance.new("TextButton")
local JumpHeightLabel = Instance.new("TextLabel")
local JumpHeightDisplay = Instance.new("TextLabel")
local JumpMinusButton = Instance.new("TextButton")
local JumpPlusButton = Instance.new("TextButton")
local InfiniteJumpLabel = Instance.new("TextLabel")
local InfiniteJumpButton = Instance.new("TextButton")
local WarningLabel = Instance.new("TextLabel")

-- Fly Elements (Ability Category)
local FlyLabel = Instance.new("TextLabel")
local FlyToggleButton = Instance.new("TextButton")
local FlySpeedLabel = Instance.new("TextLabel")
local FlySpeedDisplay = Instance.new("TextLabel")
local FlySpeedMinus = Instance.new("TextButton")
local FlySpeedPlus = Instance.new("TextButton")

-- Fling Aura Elements (Ability Category)
local FlingAuraLabel = Instance.new("TextLabel")
local FlingAuraButton = Instance.new("TextButton")
local FlingDistanceLabel = Instance.new("TextLabel")
local FlingDistanceDisplay = Instance.new("TextLabel")
local FlingSliderBack = Instance.new("Frame")
local FlingSliderFill = Instance.new("Frame")
local FlingSliderButton = Instance.new("TextButton")

local MinimizedButton = Instance.new("TextButton")

-- Fly Control Frame
local FlyControlFrame = Instance.new("Frame")
local FlyUpButton = Instance.new("TextButton")
local FlyDownButton = Instance.new("TextButton")

-- ScreenGui
ScreenGui.Name = "AbilityGUI"
ScreenGui.Parent = game.CoreGui
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.ResetOnSpawn = false

-- MainFrame
MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
MainFrame.BorderSizePixel = 0
MainFrame.Position = UDim2.new(0.5, -140, 0.5, -110)
MainFrame.Size = UDim2.new(0, 280, 0, 220)
MainFrame.Active = true
MainFrame.Draggable = true
Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 10)

-- TopBar
TopBar.Parent = MainFrame
TopBar.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
TopBar.BorderSizePixel = 0
TopBar.Size = UDim2.new(1, 0, 0, 32)
Instance.new("UICorner", TopBar).CornerRadius = UDim.new(0, 10)

-- Title
TitleLabel.Parent = TopBar
TitleLabel.BackgroundTransparency = 1
TitleLabel.Position = UDim2.new(0, 10, 0, 0)
TitleLabel.Size = UDim2.new(0.6, 0, 1, 0)
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.Text = "ValkHub - Utility"
TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleLabel.TextSize = 15
TitleLabel.TextXAlignment = Enum.TextXAlignment.Left

-- MinimizeButton
MinimizeButton.Parent = TopBar
MinimizeButton.BackgroundColor3 = Color3.fromRGB(255, 170, 0)
MinimizeButton.BorderSizePixel = 0
MinimizeButton.Position = UDim2.new(1, -60, 0.5, -9)
MinimizeButton.Size = UDim2.new(0, 23, 0, 18)
MinimizeButton.Font = Enum.Font.GothamBold
MinimizeButton.Text = "-"
MinimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MinimizeButton.TextSize = 16
Instance.new("UICorner", MinimizeButton).CornerRadius = UDim.new(0, 4)

-- ExitButton
ExitButton.Parent = TopBar
ExitButton.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
ExitButton.BorderSizePixel = 0
ExitButton.Position = UDim2.new(1, -32, 0.5, -9)
ExitButton.Size = UDim2.new(0, 23, 0, 18)
ExitButton.Font = Enum.Font.GothamBold
ExitButton.Text = "X"
ExitButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ExitButton.TextSize = 13
Instance.new("UICorner", ExitButton).CornerRadius = UDim.new(0, 4)

-- ContentFrame
ContentFrame.Parent = MainFrame
ContentFrame.BackgroundTransparency = 1
ContentFrame.Position = UDim2.new(0, 0, 0, 32)
ContentFrame.Size = UDim2.new(1, 0, 1, -32)

-- LeftFrame
LeftFrame.Parent = ContentFrame
LeftFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
LeftFrame.BorderSizePixel = 0
LeftFrame.Size = UDim2.new(0, 85, 1, 0)
LeftFrame.ScrollBarThickness = 3
LeftFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
LeftFrame.ScrollBarImageColor3 = Color3.fromRGB(70, 255, 70)
Instance.new("UICorner", LeftFrame).CornerRadius = UDim.new(0, 8)

local LeftList = Instance.new("UIListLayout", LeftFrame)
LeftList.SortOrder = Enum.SortOrder.LayoutOrder
LeftList.Padding = UDim.new(0, 5)
LeftList.HorizontalAlignment = Enum.HorizontalAlignment.Center

local LeftPad = Instance.new("UIPadding", LeftFrame)
LeftPad.PaddingTop = UDim.new(0, 6)
LeftPad.PaddingBottom = UDim.new(0, 6)
LeftPad.PaddingLeft = UDim.new(0, 7)
LeftPad.PaddingRight = UDim.new(0, 7)

-- MovementButton
MovementButton.Parent = LeftFrame
MovementButton.BackgroundColor3 = Color3.fromRGB(70, 255, 70)
MovementButton.BorderSizePixel = 0
MovementButton.Size = UDim2.new(1, -14, 0, 28)
MovementButton.Font = Enum.Font.GothamBold
MovementButton.Text = "Movement"
MovementButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MovementButton.TextSize = 10
MovementButton.LayoutOrder = 1
Instance.new("UICorner", MovementButton).CornerRadius = UDim.new(0, 5)

-- AbilityButton
AbilityButton.Parent = LeftFrame
AbilityButton.BackgroundColor3 = Color3.fromRGB(120, 120, 130)
AbilityButton.BorderSizePixel = 0
AbilityButton.Size = UDim2.new(1, -14, 0, 28)
AbilityButton.Font = Enum.Font.GothamBold
AbilityButton.Text = "Ability"
AbilityButton.TextColor3 = Color3.fromRGB(255, 255, 255)
AbilityButton.TextSize = 10
AbilityButton.LayoutOrder = 2
Instance.new("UICorner", AbilityButton).CornerRadius = UDim.new(0, 5)

LeftList:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    LeftFrame.CanvasSize = UDim2.new(0, 0, 0, LeftList.AbsoluteContentSize.Y + 12)
end)

-- RightFrame
RightFrame.Parent = ContentFrame
RightFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
RightFrame.BorderSizePixel = 0
RightFrame.Position = UDim2.new(0, 90, 0, 0)
RightFrame.Size = UDim2.new(1, -90, 1, 0)
RightFrame.ScrollBarThickness = 3
RightFrame.CanvasSize = UDim2.new(0, 0, 0, 220)
RightFrame.ScrollBarImageColor3 = Color3.fromRGB(70, 255, 70)
Instance.new("UICorner", RightFrame).CornerRadius = UDim.new(0, 8)

-- WalkspeedLabel
WalkspeedLabel.Parent = RightFrame
WalkspeedLabel.BackgroundTransparency = 1
WalkspeedLabel.Position = UDim2.new(0, 10, 0, 8)
WalkspeedLabel.Size = UDim2.new(0, 100, 0, 18)
WalkspeedLabel.Font = Enum.Font.Gotham
WalkspeedLabel.Text = "Walkspeed:"
WalkspeedLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
WalkspeedLabel.TextSize = 12
WalkspeedLabel.TextXAlignment = Enum.TextXAlignment.Left

-- SpeedDisplay
SpeedDisplay.Parent = RightFrame
SpeedDisplay.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
SpeedDisplay.BorderSizePixel = 0
SpeedDisplay.Position = UDim2.new(0, 10, 0, 28)
SpeedDisplay.Size = UDim2.new(0, 50, 0, 26)
SpeedDisplay.Font = Enum.Font.Gotham
SpeedDisplay.Text = tostring(currentSpeed)
SpeedDisplay.TextColor3 = Color3.fromRGB(255, 255, 255)
SpeedDisplay.TextSize = 14
Instance.new("UICorner", SpeedDisplay).CornerRadius = UDim.new(0, 5)

-- MinusButton
MinusButton.Parent = RightFrame
MinusButton.BackgroundColor3 = Color3.fromRGB(255, 70, 70)
MinusButton.BorderSizePixel = 0
MinusButton.Position = UDim2.new(0, 65, 0, 28)
MinusButton.Size = UDim2.new(0, 28, 0, 26)
MinusButton.Font = Enum.Font.GothamBold
MinusButton.Text = "-"
MinusButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MinusButton.TextSize = 18
Instance.new("UICorner", MinusButton).CornerRadius = UDim.new(0, 5)

-- PlusButton
PlusButton.Parent = RightFrame
PlusButton.BackgroundColor3 = Color3.fromRGB(70, 255, 70)
PlusButton.BorderSizePixel = 0
PlusButton.Position = UDim2.new(0, 98, 0, 28)
PlusButton.Size = UDim2.new(0, 28, 0, 26)
PlusButton.Font = Enum.Font.GothamBold
PlusButton.Text = "+"
PlusButton.TextColor3 = Color3.fromRGB(255, 255, 255)
PlusButton.TextSize = 18
Instance.new("UICorner", PlusButton).CornerRadius = UDim.new(0, 5)

-- JumpHeightLabel
JumpHeightLabel.Parent = RightFrame
JumpHeightLabel.BackgroundTransparency = 1
JumpHeightLabel.Position = UDim2.new(0, 10, 0, 62)
JumpHeightLabel.Size = UDim2.new(0, 100, 0, 18)
JumpHeightLabel.Font = Enum.Font.Gotham
JumpHeightLabel.Text = "Jump Height:"
JumpHeightLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
JumpHeightLabel.TextSize = 12
JumpHeightLabel.TextXAlignment = Enum.TextXAlignment.Left

-- JumpHeightDisplay
JumpHeightDisplay.Parent = RightFrame
JumpHeightDisplay.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
JumpHeightDisplay.BorderSizePixel = 0
JumpHeightDisplay.Position = UDim2.new(0, 10, 0, 82)
JumpHeightDisplay.Size = UDim2.new(0, 50, 0, 26)
JumpHeightDisplay.Font = Enum.Font.Gotham
JumpHeightDisplay.Text = tostring(currentJumpHeight)
JumpHeightDisplay.TextColor3 = Color3.fromRGB(255, 255, 255)
JumpHeightDisplay.TextSize = 14
Instance.new("UICorner", JumpHeightDisplay).CornerRadius = UDim.new(0, 5)

-- JumpMinusButton
JumpMinusButton.Parent = RightFrame
JumpMinusButton.BackgroundColor3 = Color3.fromRGB(255, 70, 70)
JumpMinusButton.BorderSizePixel = 0
JumpMinusButton.Position = UDim2.new(0, 65, 0, 82)
JumpMinusButton.Size = UDim2.new(0, 28, 0, 26)
JumpMinusButton.Font = Enum.Font.GothamBold
JumpMinusButton.Text = "-"
JumpMinusButton.TextColor3 = Color3.fromRGB(255, 255, 255)
JumpMinusButton.TextSize = 18
Instance.new("UICorner", JumpMinusButton).CornerRadius = UDim.new(0, 5)

-- JumpPlusButton
JumpPlusButton.Parent = RightFrame
JumpPlusButton.BackgroundColor3 = Color3.fromRGB(70, 255, 70)
JumpPlusButton.BorderSizePixel = 0
JumpPlusButton.Position = UDim2.new(0, 98, 0, 82)
JumpPlusButton.Size = UDim2.new(0, 28, 0, 26)
JumpPlusButton.Font = Enum.Font.GothamBold
JumpPlusButton.Text = "+"
JumpPlusButton.TextColor3 = Color3.fromRGB(255, 255, 255)
JumpPlusButton.TextSize = 18
Instance.new("UICorner", JumpPlusButton).CornerRadius = UDim.new(0, 5)

-- InfiniteJumpLabel
InfiniteJumpLabel.Parent = RightFrame
InfiniteJumpLabel.BackgroundTransparency = 1
InfiniteJumpLabel.Position = UDim2.new(0, 10, 0, 116)
InfiniteJumpLabel.Size = UDim2.new(0, 100, 0, 18)
InfiniteJumpLabel.Font = Enum.Font.Gotham
InfiniteJumpLabel.Text = "Infinite Jump:"
InfiniteJumpLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
InfiniteJumpLabel.TextSize = 12
InfiniteJumpLabel.TextXAlignment = Enum.TextXAlignment.Left

-- InfiniteJumpButton
InfiniteJumpButton.Parent = RightFrame
InfiniteJumpButton.BackgroundColor3 = Color3.fromRGB(255, 70, 70)
InfiniteJumpButton.BorderSizePixel = 0
InfiniteJumpButton.Position = UDim2.new(0, 10, 0, 136)
InfiniteJumpButton.Size = UDim2.new(0, 55, 0, 26)
InfiniteJumpButton.Font = Enum.Font.Gotham
InfiniteJumpButton.Text = "OFF"
InfiniteJumpButton.TextColor3 = Color3.fromRGB(255, 255, 255)
InfiniteJumpButton.TextSize = 12
Instance.new("UICorner", InfiniteJumpButton).CornerRadius = UDim.new(0, 5)

-- WarningLabel
WarningLabel.Parent = RightFrame
WarningLabel.BackgroundTransparency = 1
WarningLabel.Position = UDim2.new(0, 10, 0, 170)
WarningLabel.Size = UDim2.new(1, -20, 0, 16)
WarningLabel.Font = Enum.Font.Gotham
WarningLabel.Text = ""
WarningLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
WarningLabel.TextSize = 10
WarningLabel.Visible = false

-- ============ FLY ELEMENTS (ABILITY CATEGORY) ============
-- FlyLabel
FlyLabel.Parent = RightFrame
FlyLabel.BackgroundTransparency = 1
FlyLabel.Position = UDim2.new(0, 10, 0, 8)
FlyLabel.Size = UDim2.new(0, 100, 0, 18)
FlyLabel.Font = Enum.Font.Gotham
FlyLabel.Text = "Fly Mode:"
FlyLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
FlyLabel.TextSize = 12
FlyLabel.TextXAlignment = Enum.TextXAlignment.Left
FlyLabel.Visible = false

-- FlyToggleButton
FlyToggleButton.Parent = RightFrame
FlyToggleButton.BackgroundColor3 = Color3.fromRGB(255, 70, 70)
FlyToggleButton.BorderSizePixel = 0
FlyToggleButton.Position = UDim2.new(0, 10, 0, 28)
FlyToggleButton.Size = UDim2.new(0, 55, 0, 26)
FlyToggleButton.Font = Enum.Font.Gotham
FlyToggleButton.Text = "OFF"
FlyToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
FlyToggleButton.TextSize = 12
FlyToggleButton.Visible = false
Instance.new("UICorner", FlyToggleButton).CornerRadius = UDim.new(0, 5)

-- FlySpeedLabel
FlySpeedLabel.Parent = RightFrame
FlySpeedLabel.BackgroundTransparency = 1
FlySpeedLabel.Position = UDim2.new(0, 10, 0, 62)
FlySpeedLabel.Size = UDim2.new(0, 100, 0, 18)
FlySpeedLabel.Font = Enum.Font.Gotham
FlySpeedLabel.Text = "Fly Speed:"
FlySpeedLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
FlySpeedLabel.TextSize = 12
FlySpeedLabel.TextXAlignment = Enum.TextXAlignment.Left
FlySpeedLabel.Visible = false

-- FlySpeedDisplay
FlySpeedDisplay.Parent = RightFrame
FlySpeedDisplay.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
FlySpeedDisplay.BorderSizePixel = 0
FlySpeedDisplay.Position = UDim2.new(0, 10, 0, 82)
FlySpeedDisplay.Size = UDim2.new(0, 50, 0, 26)
FlySpeedDisplay.Font = Enum.Font.Gotham
FlySpeedDisplay.Text = tostring(speeds)
FlySpeedDisplay.TextColor3 = Color3.fromRGB(255, 255, 255)
FlySpeedDisplay.TextSize = 14
FlySpeedDisplay.Visible = false
Instance.new("UICorner", FlySpeedDisplay).CornerRadius = UDim.new(0, 5)

-- FlySpeedMinus
FlySpeedMinus.Parent = RightFrame
FlySpeedMinus.BackgroundColor3 = Color3.fromRGB(255, 70, 70)
FlySpeedMinus.BorderSizePixel = 0
FlySpeedMinus.Position = UDim2.new(0, 65, 0, 82)
FlySpeedMinus.Size = UDim2.new(0, 28, 0, 26)
FlySpeedMinus.Font = Enum.Font.GothamBold
FlySpeedMinus.Text = "-"
FlySpeedMinus.TextColor3 = Color3.fromRGB(255, 255, 255)
FlySpeedMinus.TextSize = 18
FlySpeedMinus.Visible = false
Instance.new("UICorner", FlySpeedMinus).CornerRadius = UDim.new(0, 5)

-- FlySpeedPlus
FlySpeedPlus.Parent = RightFrame
FlySpeedPlus.BackgroundColor3 = Color3.fromRGB(70, 255, 70)
FlySpeedPlus.BorderSizePixel = 0
FlySpeedPlus.Position = UDim2.new(0, 98, 0, 82)
FlySpeedPlus.Size = UDim2.new(0, 28, 0, 26)
FlySpeedPlus.Font = Enum.Font.GothamBold
FlySpeedPlus.Text = "+"
FlySpeedPlus.TextColor3 = Color3.fromRGB(255, 255, 255)
FlySpeedPlus.TextSize = 18
FlySpeedPlus.Visible = false
Instance.new("UICorner", FlySpeedPlus).CornerRadius = UDim.new(0, 5)

-- ============ FLING AURA ELEMENTS ============
-- FlingAuraLabel
FlingAuraLabel.Parent = RightFrame
FlingAuraLabel.BackgroundTransparency = 1
FlingAuraLabel.Position = UDim2.new(0, 10, 0, 116)
FlingAuraLabel.Size = UDim2.new(0, 100, 0, 18)
FlingAuraLabel.Font = Enum.Font.Gotham
FlingAuraLabel.Text = "Fling Aura:"
FlingAuraLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
FlingAuraLabel.TextSize = 12
FlingAuraLabel.TextXAlignment = Enum.TextXAlignment.Left
FlingAuraLabel.Visible = false

-- FlingAuraButton
FlingAuraButton.Parent = RightFrame
FlingAuraButton.BackgroundColor3 = Color3.fromRGB(255, 70, 70)
FlingAuraButton.BorderSizePixel = 0
FlingAuraButton.Position = UDim2.new(0, 10, 0, 136)
FlingAuraButton.Size = UDim2.new(0, 55, 0, 26)
FlingAuraButton.Font = Enum.Font.Gotham
FlingAuraButton.Text = "OFF"
FlingAuraButton.TextColor3 = Color3.fromRGB(255, 255, 255)
FlingAuraButton.TextSize = 12
FlingAuraButton.Visible = false
Instance.new("UICorner", FlingAuraButton).CornerRadius = UDim.new(0, 5)

-- FlingDistanceLabel
FlingDistanceLabel.Parent = RightFrame
FlingDistanceLabel.BackgroundTransparency = 1
FlingDistanceLabel.Position = UDim2.new(0, 10, 0, 170)
FlingDistanceLabel.Size = UDim2.new(0, 120, 0, 18)
FlingDistanceLabel.Font = Enum.Font.Gotham
FlingDistanceLabel.Text = "Fling Distance: 5"
FlingDistanceLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
FlingDistanceLabel.TextSize = 12
FlingDistanceLabel.TextXAlignment = Enum.TextXAlignment.Left
FlingDistanceLabel.Visible = false

-- FlingSliderBack
FlingSliderBack.Parent = RightFrame
FlingSliderBack.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
FlingSliderBack.BorderSizePixel = 0
FlingSliderBack.Position = UDim2.new(0, 10, 0, 195)
FlingSliderBack.Size = UDim2.new(0, 160, 0, 8)
FlingSliderBack.Visible = false
Instance.new("UICorner", FlingSliderBack).CornerRadius = UDim.new(0, 4)

-- FlingSliderFill
FlingSliderFill.Parent = FlingSliderBack
FlingSliderFill.BackgroundColor3 = Color3.fromRGB(70, 255, 70)
FlingSliderFill.BorderSizePixel = 0
FlingSliderFill.Size = UDim2.new(0.267, 0, 1, 0)
Instance.new("UICorner", FlingSliderFill).CornerRadius = UDim.new(0, 4)

-- FlingSliderButton
FlingSliderButton.Parent = FlingSliderBack
FlingSliderButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
FlingSliderButton.BorderSizePixel = 0
FlingSliderButton.Position = UDim2.new(0.267, -8, 0.5, -8)
FlingSliderButton.Size = UDim2.new(0, 16, 0, 16)
FlingSliderButton.Text = ""
FlingSliderButton.AutoButtonColor = false
local sliderCorner = Instance.new("UICorner", FlingSliderButton)
sliderCorner.CornerRadius = UDim.new(1, 0)

-- FlyControlFrame (Only UP/DOWN buttons - Draggable)
FlyControlFrame.Parent = ScreenGui
FlyControlFrame.BackgroundColor3 = Color3.fromRGB(163, 255, 137)
FlyControlFrame.BorderColor3 = Color3.fromRGB(103, 221, 213)
FlyControlFrame.BorderSizePixel = 2
FlyControlFrame.Position = UDim2.new(0.1, 0, 0.38, 0)
FlyControlFrame.Size = UDim2.new(0, 44, 0, 57)
FlyControlFrame.Active = true
FlyControlFrame.Draggable = true
FlyControlFrame.Visible = false

-- FlyUpButton
FlyUpButton.Name = "up"
FlyUpButton.Parent = FlyControlFrame
FlyUpButton.BackgroundColor3 = Color3.fromRGB(79, 255, 152)
FlyUpButton.BorderSizePixel = 0
FlyUpButton.Size = UDim2.new(0, 44, 0, 28)
FlyUpButton.Font = Enum.Font.SourceSans
FlyUpButton.Text = "UP"
FlyUpButton.TextColor3 = Color3.fromRGB(0, 0, 0)
FlyUpButton.TextSize = 14

-- FlyDownButton
FlyDownButton.Name = "down"
FlyDownButton.Parent = FlyControlFrame
FlyDownButton.BackgroundColor3 = Color3.fromRGB(215, 255, 121)
FlyDownButton.BorderSizePixel = 0
FlyDownButton.Position = UDim2.new(0, 0, 0.491228074, 0)
FlyDownButton.Size = UDim2.new(0, 44, 0, 28)
FlyDownButton.Font = Enum.Font.SourceSans
FlyDownButton.Text = "DOWN"
FlyDownButton.TextColor3 = Color3.fromRGB(0, 0, 0)
FlyDownButton.TextSize = 14

-- MinimizedButton
MinimizedButton.Parent = ScreenGui
MinimizedButton.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
MinimizedButton.BorderSizePixel = 0
MinimizedButton.Position = UDim2.new(0.5, -60, 0, 10)
MinimizedButton.Size = UDim2.new(0, 120, 0, 40)
MinimizedButton.Font = Enum.Font.GothamBold
MinimizedButton.Text = "ValkHub"
MinimizedButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MinimizedButton.TextSize = 16
MinimizedButton.Visible = false
MinimizedButton.Active = true
MinimizedButton.Draggable = true
Instance.new("UICorner", MinimizedButton).CornerRadius = UDim.new(0, 8)

local UIStroke = Instance.new("UIStroke", MinimizedButton)
UIStroke.Thickness = 2

-- RGB Animation
spawn(function()
    while true do
        for hue = 0, 1, 0.01 do
            UIStroke.Color = Color3.fromHSV(hue, 1, 1)
            wait(0.03)
        end
    end
end)


-- ============ ORIGINAL FLY FUNCTIONS ============
local speaker = player
local chr = player.Character
local hum = chr and chr:FindFirstChildWhichIsA("Humanoid")
local tpwalking = false

game:GetService("StarterGui"):SetCore("SendNotification", { 
    Title = "ValkHub - Fly Loaded";
    Text = "Original Fly System Integrated";
    Icon = "rbxthumb://type=Asset&id=5107182114&w=150&h=150"})

-- Original Fly Toggle Function
local function toggleFly()
    if nowe == true then
        -- DISABLE FLY
        nowe = false
        FlyControlFrame.Visible = false

        speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Climbing,true)
        speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.FallingDown,true)
        speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Flying,true)
        speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Freefall,true)
        speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.GettingUp,true)
        speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Jumping,true)
        speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Landed,true)
        speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Physics,true)
        speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.PlatformStanding,true)
        speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Ragdoll,true)
        speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Running,true)
        speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.RunningNoPhysics,true)
        speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Seated,true)
        speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.StrafingNoPhysics,true)
        speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Swimming,true)
        speaker.Character.Humanoid:ChangeState(Enum.HumanoidStateType.RunningNoPhysics)
    else 
        -- ENABLE FLY
        nowe = true
        FlyControlFrame.Visible = true

        for i = 1, speeds do
            spawn(function()
                local hb = game:GetService("RunService").Heartbeat    
                tpwalking = true
                local chr = game.Players.LocalPlayer.Character
                local hum = chr and chr:FindFirstChildWhichIsA("Humanoid")
                while tpwalking and hb:Wait() and chr and hum and hum.Parent do
                    if hum.MoveDirection.Magnitude > 0 then
                        chr:TranslateBy(hum.MoveDirection)
                    end
                end
            end)
        end
        
        game.Players.LocalPlayer.Character.Animate.Disabled = true
        local Char = game.Players.LocalPlayer.Character
        local Hum = Char:FindFirstChildOfClass("Humanoid") or Char:FindFirstChildOfClass("AnimationController")

        for i,v in next, Hum:GetPlayingAnimationTracks() do
            v:AdjustSpeed(0)
        end
        
        speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Climbing,false)
        speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.FallingDown,false)
        speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Flying,false)
        speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Freefall,false)
        speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.GettingUp,false)
        speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Jumping,false)
        speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Landed,false)
        speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Physics,false)
        speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.PlatformStanding,false)
        speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Ragdoll,false)
        speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Running,false)
        speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.RunningNoPhysics,false)
        speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Seated,false)
        speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.StrafingNoPhysics,false)
        speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Swimming,false)
        speaker.Character.Humanoid:ChangeState(Enum.HumanoidStateType.Swimming)
    end

    -- Original Fly Logic (R6/R15 compatible)
    if game:GetService("Players").LocalPlayer.Character:FindFirstChildOfClass("Humanoid").RigType == Enum.HumanoidRigType.R6 then
        local plr = game.Players.LocalPlayer
        local torso = plr.Character.Torso
        local flying = true
        local deb = true
        local ctrl = {f = 0, b = 0, l = 0, r = 0}
        local lastctrl = {f = 0, b = 0, l = 0, r = 0}
        local maxspeed = 50
        local speed = 0

        local bg = Instance.new("BodyGyro", torso)
        bg.P = 9e4
        bg.maxTorque = Vector3.new(9e9, 9e9, 9e9)
        bg.cframe = torso.CFrame
        local bv = Instance.new("BodyVelocity", torso)
        bv.velocity = Vector3.new(0,0.1,0)
        bv.maxForce = Vector3.new(9e9, 9e9, 9e9)
        if nowe == true then
            plr.Character.Humanoid.PlatformStand = true
        end
        while nowe == true or game:GetService("Players").LocalPlayer.Character.Humanoid.Health == 0 do
            game:GetService("RunService").RenderStepped:Wait()

            if ctrl.l + ctrl.r ~= 0 or ctrl.f + ctrl.b ~= 0 then
                speed = speed+.5+(speed/maxspeed)
                if speed > maxspeed then
                    speed = maxspeed
                end
            elseif not (ctrl.l + ctrl.r ~= 0 or ctrl.f + ctrl.b ~= 0) and speed ~= 0 then
                speed = speed-1
                if speed < 0 then
                    speed = 0
                end
            end
            if (ctrl.l + ctrl.r) ~= 0 or (ctrl.f + ctrl.b) ~= 0 then
                bv.velocity = ((game.Workspace.CurrentCamera.CoordinateFrame.lookVector * (ctrl.f+ctrl.b)) + ((game.Workspace.CurrentCamera.CoordinateFrame * CFrame.new(ctrl.l+ctrl.r,(ctrl.f+ctrl.b)*.2,0).p) - game.Workspace.CurrentCamera.CoordinateFrame.p))*speed
                lastctrl = {f = ctrl.f, b = ctrl.b, l = ctrl.l, r = ctrl.r}
            elseif (ctrl.l + ctrl.r) == 0 and (ctrl.f + ctrl.b) == 0 and speed ~= 0 then
                bv.velocity = ((game.Workspace.CurrentCamera.CoordinateFrame.lookVector * (lastctrl.f+lastctrl.b)) + ((game.Workspace.CurrentCamera.CoordinateFrame * CFrame.new(lastctrl.l+lastctrl.r,(lastctrl.f+lastctrl.b)*.2,0).p) - game.Workspace.CurrentCamera.CoordinateFrame.p))*speed
            else
                bv.velocity = Vector3.new(0,0,0)
            end
            bg.cframe = game.Workspace.CurrentCamera.CoordinateFrame * CFrame.Angles(-math.rad((ctrl.f+ctrl.b)*50*speed/maxspeed),0,0)
        end
        ctrl = {f = 0, b = 0, l = 0, r = 0}
        lastctrl = {f = 0, b = 0, l = 0, r = 0}
        speed = 0
        bg:Destroy()
        bv:Destroy()
        plr.Character.Humanoid.PlatformStand = false
        game.Players.LocalPlayer.Character.Animate.Disabled = false
        tpwalking = false
    else
        local plr = game.Players.LocalPlayer
        local UpperTorso = plr.Character.UpperTorso
        local flying = true
        local deb = true
        local ctrl = {f = 0, b = 0, l = 0, r = 0}
        local lastctrl = {f = 0, b = 0, l = 0, r = 0}
        local maxspeed = 50
        local speed = 0

        local bg = Instance.new("BodyGyro", UpperTorso)
        bg.P = 9e4
        bg.maxTorque = Vector3.new(9e9, 9e9, 9e9)
        bg.cframe = UpperTorso.CFrame
        local bv = Instance.new("BodyVelocity", UpperTorso)
        bv.velocity = Vector3.new(0,0.1,0)
        bv.maxForce = Vector3.new(9e9, 9e9, 9e9)
        if nowe == true then
            plr.Character.Humanoid.PlatformStand = true
        end
        while nowe == true or game:GetService("Players").LocalPlayer.Character.Humanoid.Health == 0 do
            wait()

            if ctrl.l + ctrl.r ~= 0 or ctrl.f + ctrl.b ~= 0 then
                speed = speed+.5+(speed/maxspeed)
                if speed > maxspeed then
                    speed = maxspeed
                end
            elseif not (ctrl.l + ctrl.r ~= 0 or ctrl.f + ctrl.b ~= 0) and speed ~= 0 then
                speed = speed-1
                if speed < 0 then
                    speed = 0
                end
            end
            if (ctrl.l + ctrl.r) ~= 0 or (ctrl.f + ctrl.b) ~= 0 then
                bv.velocity = ((game.Workspace.CurrentCamera.CoordinateFrame.lookVector * (ctrl.f+ctrl.b)) + ((game.Workspace.CurrentCamera.CoordinateFrame * CFrame.new(ctrl.l+ctrl.r,(ctrl.f+ctrl.b)*.2,0).p) - game.Workspace.CurrentCamera.CoordinateFrame.p))*speed
                lastctrl = {f = ctrl.f, b = ctrl.b, l = ctrl.l, r = ctrl.r}
            elseif (ctrl.l + ctrl.r) == 0 and (ctrl.f + ctrl.b) == 0 and speed ~= 0 then
                bv.velocity = ((game.Workspace.CurrentCamera.CoordinateFrame.lookVector * (lastctrl.f+lastctrl.b)) + ((game.Workspace.CurrentCamera.CoordinateFrame * CFrame.new(lastctrl.l+lastctrl.r,(lastctrl.f+lastctrl.b)*.2,0).p) - game.Workspace.CurrentCamera.CoordinateFrame.p))*speed
            else
                bv.velocity = Vector3.new(0,0,0)
            end

            bg.cframe = game.Workspace.CurrentCamera.CoordinateFrame * CFrame.Angles(-math.rad((ctrl.f+ctrl.b)*50*speed/maxspeed),0,0)
        end
        ctrl = {f = 0, b = 0, l = 0, r = 0}
        lastctrl = {f = 0, b = 0, l = 0, r = 0}
        speed = 0
        bg:Destroy()
        bv:Destroy()
        plr.Character.Humanoid.PlatformStand = false
        game.Players.LocalPlayer.Character.Animate.Disabled = false
        tpwalking = false
    end
end

-- UP/DOWN Button Handlers (Original)
FlyUpButton.MouseButton1Down:connect(function()
    flyUpConnection = FlyUpButton.MouseEnter:connect(function()
        while flyUpConnection do
            wait()
            game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame * CFrame.new(0,1,0)
        end
    end)
end)

FlyUpButton.MouseLeave:connect(function()
    if flyUpConnection then
        flyUpConnection:Disconnect()
        flyUpConnection = nil
    end
end)

FlyDownButton.MouseButton1Down:connect(function()
    flyDownConnection = FlyDownButton.MouseEnter:connect(function()
        while flyDownConnection do
            wait()
            game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame * CFrame.new(0,-1,0)
        end
    end)
end)

FlyDownButton.MouseLeave:connect(function()
    if flyDownConnection then
        flyDownConnection:Disconnect()
        flyDownConnection = nil
    end
end)

-- Character Reset Handler
game:GetService("Players").LocalPlayer.CharacterAdded:Connect(function(char)
    wait(0.7)
    game.Players.LocalPlayer.Character.Humanoid.PlatformStand = false
    game.Players.LocalPlayer.Character.Animate.Disabled = false
end)

-- ============ OTHER FUNCTIONS ============
local function updateSpeed()
    SpeedDisplay.Text = tostring(currentSpeed)
end

local function updateJumpHeight()
    JumpHeightDisplay.Text = tostring(currentJumpHeight)
end

local function updateFlySpeed()
    FlySpeedDisplay.Text = tostring(speeds)
    if nowe == true then
        tpwalking = false
        for i = 1, speeds do
            spawn(function()
                local hb = game:GetService("RunService").Heartbeat    
                tpwalking = true
                local chr = game.Players.LocalPlayer.Character
                local hum = chr and chr:FindFirstChildWhichIsA("Humanoid")
                while tpwalking and hb:Wait() and chr and hum and hum.Parent do
                    if hum.MoveDirection.Magnitude > 0 then
                        chr:TranslateBy(hum.MoveDirection)
                    end
                end
            end)
        end
    end
end

local function showWarning(message)
    WarningLabel.Text = message
    WarningLabel.Visible = true
    wait(2)
    WarningLabel.Visible = false
end

local function switchCategory(category)
    currentCategory = category
    
    MovementButton.BackgroundColor3 = Color3.fromRGB(120, 120, 130)
    AbilityButton.BackgroundColor3 = Color3.fromRGB(120, 120, 130)
    
    WalkspeedLabel.Visible = false
    SpeedDisplay.Visible = false
    MinusButton.Visible = false
    PlusButton.Visible = false
    JumpHeightLabel.Visible = false
    JumpHeightDisplay.Visible = false
    JumpMinusButton.Visible = false
    JumpPlusButton.Visible = false
    InfiniteJumpLabel.Visible = false
    InfiniteJumpButton.Visible = false
    FlyLabel.Visible = false
    FlyToggleButton.Visible = false
    FlySpeedLabel.Visible = false
    FlySpeedDisplay.Visible = false
    FlySpeedMinus.Visible = false
    FlySpeedPlus.Visible = false
    FlingAuraLabel.Visible = false
    FlingAuraButton.Visible = false
    FlingDistanceLabel.Visible = false
    FlingSliderBack.Visible = false
    
    if category == "Movement" then
        MovementButton.BackgroundColor3 = Color3.fromRGB(70, 255, 70)
        WalkspeedLabel.Visible = true
        SpeedDisplay.Visible = true
        MinusButton.Visible = true
        PlusButton.Visible = true
        JumpHeightLabel.Visible = true
        JumpHeightDisplay.Visible = true
        JumpMinusButton.Visible = true
        JumpPlusButton.Visible = true
        InfiniteJumpLabel.Visible = true
        InfiniteJumpButton.Visible = true
    elseif category == "Ability" then
        AbilityButton.BackgroundColor3 = Color3.fromRGB(70, 255, 70)
        FlyLabel.Visible = true
        FlyToggleButton.Visible = true
        FlySpeedLabel.Visible = true
        FlySpeedDisplay.Visible = true
        FlySpeedMinus.Visible = true
        FlySpeedPlus.Visible = true
        FlingAuraLabel.Visible = true
        FlingAuraButton.Visible = true
        FlingDistanceLabel.Visible = true
        FlingSliderBack.Visible = true
    end
end

local function resetAllAbilities()
    guiActive = false
    
    local character = player.Character
    if character then
        local humanoid = character:FindFirstChild("Humanoid")
        if humanoid then
            humanoid.WalkSpeed = 16
            humanoid.JumpHeight = 7.2
        end
    end
    
    infiniteJumpEnabled = false
    
    if nowe == true then
        nowe = false
        toggleFly()
        FlyToggleButton.Text = "OFF"
        FlyToggleButton.BackgroundColor3 = Color3.fromRGB(255, 70, 70)
    end
    
    if flingAuraEnabled then
        flingAuraEnabled = false
        if flingConnection then
            flingConnection:Disconnect()
            flingConnection = nil
        end
        FlingAuraButton.Text = "OFF"
        FlingAuraButton.BackgroundColor3 = Color3.fromRGB(255, 70, 70)
    end
    
    if heartbeatConnection then
        heartbeatConnection:Disconnect()
        heartbeatConnection = nil
    end
    
    print("All abilities disabled!")
end

-- Auto Apply Walkspeed & Jump Height
heartbeatConnection = RunService.Heartbeat:Connect(function()
    if guiActive then
        local character = player.Character
        if character then
            local humanoid = character:FindFirstChild("Humanoid")
            if humanoid then
                if humanoid.WalkSpeed ~= currentSpeed then
                    humanoid.WalkSpeed = currentSpeed
                end
                if humanoid.JumpHeight ~= currentJumpHeight then
                    humanoid.JumpHeight = currentJumpHeight
                end
            end
        end
    end
end)

-- ============ BUTTON CONNECTIONS ============
MovementButton.MouseButton1Click:Connect(function()
    switchCategory("Movement")
end)

AbilityButton.MouseButton1Click:Connect(function()
    switchCategory("Ability")
end)

PlusButton.MouseButton1Click:Connect(function()
    if currentSpeed < 100 then
        currentSpeed = currentSpeed + 1
        updateSpeed()
    else
        showWarning("Walkspeed cannot be more than 100")
    end
end)

MinusButton.MouseButton1Click:Connect(function()
    if currentSpeed > 1 then
        currentSpeed = currentSpeed - 1
        updateSpeed()
    end
end)

JumpPlusButton.MouseButton1Click:Connect(function()
    if currentJumpHeight < 50 then
        currentJumpHeight = math.floor((currentJumpHeight + 0.5) * 10 + 0.5) / 10
        updateJumpHeight()
    else
        showWarning("Jump Height cannot be more than 50")
    end
end)

JumpMinusButton.MouseButton1Click:Connect(function()
    if currentJumpHeight > 1 then
        currentJumpHeight = math.floor((currentJumpHeight - 0.5) * 10 + 0.5) / 10
        updateJumpHeight()
    end
end)

InfiniteJumpButton.MouseButton1Click:Connect(function()
    infiniteJumpEnabled = not infiniteJumpEnabled
    if infiniteJumpEnabled then
        InfiniteJumpButton.Text = "ON"
        InfiniteJumpButton.BackgroundColor3 = Color3.fromRGB(70, 255, 70)
    else
        InfiniteJumpButton.Text = "OFF"
        InfiniteJumpButton.BackgroundColor3 = Color3.fromRGB(255, 70, 70)
    end
end)

-- Fly Toggle Button
FlyToggleButton.MouseButton1Click:Connect(function()
    nowe = not nowe
    
    if nowe then
        FlyToggleButton.Text = "ON"
        FlyToggleButton.BackgroundColor3 = Color3.fromRGB(70, 255, 70)
    else
        FlyToggleButton.Text = "OFF"
        FlyToggleButton.BackgroundColor3 = Color3.fromRGB(255, 70, 70)
    end
    
    toggleFly()
end)

-- Fly Speed Buttons
FlySpeedPlus.MouseButton1Click:Connect(function()
    if speeds < 100 then
        speeds = speeds + 1
        updateFlySpeed()
    else
        showWarning("Fly Speed cannot be more than 100")
    end
end)

FlySpeedMinus.MouseButton1Click:Connect(function()
    if speeds == 1 then
        showWarning("Fly Speed cannot be less than 1")
    else
        speeds = speeds - 1
        updateFlySpeed()
    end
end)

-- ============ FLING AURA SYSTEM ============
local function updateFlingDistance(value)
    flingDistance = math.clamp(math.floor(value), 1, 15)
    FlingDistanceLabel.Text = "Fling Distance: " .. tostring(flingDistance)
    local percent = (flingDistance - 1) / 14
    FlingSliderFill.Size = UDim2.new(percent, 0, 1, 0)
    FlingSliderButton.Position = UDim2.new(percent, -8, 0.5, -8)
end

local function startFlingAura()
    if flingConnection then
        flingConnection:Disconnect()
    end
    
    flingConnection = RunService.Heartbeat:Connect(function()
        if not flingAuraEnabled then return end
        
        local character = player.Character
        if not character then return end
        
        local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
        if not humanoidRootPart then return end
        
        for _, otherPlayer in pairs(game.Players:GetPlayers()) do
            if otherPlayer ~= player then
                local otherCharacter = otherPlayer.Character
                if otherCharacter then
                    local otherHRP = otherCharacter:FindFirstChild("HumanoidRootPart")
                    if otherHRP then
                        local distance = (humanoidRootPart.Position - otherHRP.Position).Magnitude
                        if distance <= flingDistance then
                            local direction = (otherHRP.Position - humanoidRootPart.Position).Unit
                            local flingForce = direction * 100
                            
                            local bodyVelocity = Instance.new("BodyVelocity")
                            bodyVelocity.Velocity = flingForce
                            bodyVelocity.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
                            bodyVelocity.Parent = otherHRP
                            
                            game:GetService("Debris"):AddItem(bodyVelocity, 0.1)
                        end
                    end
                end
            end
        end
    end)
end

local function stopFlingAura()
    if flingConnection then
        flingConnection:Disconnect()
        flingConnection = nil
    end
end

-- Fling Aura Toggle Button
FlingAuraButton.MouseButton1Click:Connect(function()
    flingAuraEnabled = not flingAuraEnabled
    if flingAuraEnabled then
        FlingAuraButton.Text = "ON"
        FlingAuraButton.BackgroundColor3 = Color3.fromRGB(70, 255, 70)
        startFlingAura()
    else
        FlingAuraButton.Text = "OFF"
        FlingAuraButton.BackgroundColor3 = Color3.fromRGB(255, 70, 70)
        stopFlingAura()
    end
end)

-- Fling Slider Logic
local dragging = false

FlingSliderButton.MouseButton1Down:Connect(function()
    dragging = true
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local mousePos = UserInputService:GetMouseLocation()
        local sliderPos = FlingSliderBack.AbsolutePosition.X
        local sliderSize = FlingSliderBack.AbsoluteSize.X
        local relativePos = math.clamp((mousePos.X - sliderPos) / sliderSize, 0, 1)
        local newValue = 1 + (relativePos * 14)
        updateFlingDistance(newValue)
    end
end)

FlingSliderBack.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        local mousePos = UserInputService:GetMouseLocation()
        local sliderPos = FlingSliderBack.AbsolutePosition.X
        local sliderSize = FlingSliderBack.AbsoluteSize.X
        local relativePos = math.clamp((mousePos.X - sliderPos) / sliderSize, 0, 1)
        local newValue = 1 + (relativePos * 14)
        updateFlingDistance(newValue)
    end
end)

MinimizeButton.MouseButton1Click:Connect(function()
    isMinimized = not isMinimized
    MainFrame.Visible = not isMinimized
    MinimizedButton.Visible = isMinimized
    print("GUI Minimized - Features still active!")
end)

MinimizedButton.MouseButton1Click:Connect(function()
    isMinimized = false
    MainFrame.Visible = true
    MinimizedButton.Visible = false
    print("GUI Restored!")
end)

ExitButton.MouseButton1Click:Connect(function()
    resetAllAbilities()
    ScreenGui:Destroy()
    print("GUI Closed - All features disabled!")
end)

-- Infinite Jump Logic
UserInputService.JumpRequest:Connect(function()
    if guiActive and infiniteJumpEnabled then
        local character = player.Character
        if character then
            local humanoid = character:FindFirstChild("Humanoid")
            if humanoid then
                humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
            end
        end
    end
end)

-- Character Reset Handler (for all features)
player.CharacterAdded:Connect(function(character)
    if nowe then
        nowe = false
        FlyControlFrame.Visible = false
        FlyToggleButton.Text = "OFF"
        FlyToggleButton.BackgroundColor3 = Color3.fromRGB(255, 70, 70)
    end
    
    if flingAuraEnabled then
        stopFlingAura()
        flingAuraEnabled = false
        FlingAuraButton.Text = "OFF"
        FlingAuraButton.BackgroundColor3 = Color3.fromRGB(255, 70, 70)
    end
    
    if guiActive then
        local humanoid = character:WaitForChild("Humanoid")
        wait(0.1)
        humanoid.WalkSpeed = currentSpeed
        humanoid.JumpHeight = currentJumpHeight
    else
        local humanoid = character:WaitForChild("Humanoid")
        wait(0.1)
        humanoid.WalkSpeed = 16
        humanoid.JumpHeight = 7.2
    end
end)
